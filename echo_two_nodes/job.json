{
  "jobUid": "3bb6fd55-0606-4dfb-9fa8-0f76a4c06eda",
  "nodes": {
    "submission": {
      "submissionCode": {
        "student/main.go": "// student main.go\npackage main\n\nimport (\n\t\"context\"\n\t\"encoding/json\"\n\t\"log\"\n\t\"os\"\n\t\"strings\"\n\n\t\"runner/shared\"\n\n\t\"github.com/distcodep7/dsnet/dsnet\"\n)\n\nvar Peers []string\n\ntype EchoNode struct{ Net *dsnet.Node }\n\nfunc NewEchoNode(id string) *EchoNode {\n\tn, err := dsnet.NewNode(id, \"test-container:50051\")\n\tif err != nil {\n\t\tlog.Fatalf(\"Failed to create node %s: %v\", id, err)\n\t}\n    \n\treturn &EchoNode{Net: n}\n}\n\nfunc newBaseMessage(from, to, msgType string) dsnet.BaseMessage {\n\treturn dsnet.BaseMessage{From: from, To: to, Type: msgType}\n}\n\nfunc (en *EchoNode) Run(ctx context.Context) {\n\tdefer en.Net.Close()\n\tfor {\n\t\tselect {\n\t\tcase event := <-en.Net.Inbound:\n\t\t\ten.handleEvent(ctx, event)\n\t\tcase <-ctx.Done():\n\t\t\tos.Exit(0)\n\t\t}\n\t}\n}\n\nfunc (en *EchoNode) handleEvent(ctx context.Context, event dsnet.Event) {\n\tswitch event.Type {\n\tcase \"SendTrigger\":\n\t\tvar msg shared.SendTrigger\n\t\tjson.Unmarshal(event.Payload, &msg)\n\t\ten.Net.Send(ctx, Peers[1], shared.EchoMessage{\n\t\t\tBaseMessage: newBaseMessage(en.Net.ID, Peers[1], \"EchoMessage\"),\n\t\t\tEchoID:      msg.EchoID,\n\t\t\tContent:     msg.Content,\n\t\t})\n\tcase \"EchoMessage\":\n\t\tvar msg shared.EchoMessage\n\t\tjson.Unmarshal(event.Payload, &msg)\n\t\t\n\t\ten.Net.Send(ctx, msg.From, shared.EchoResponse{\n\t\t\tBaseMessage: newBaseMessage(en.Net.ID, msg.From, \"EchoResponse\"),\n\t\t\tEchoID:      msg.EchoID,\n\t\t\tContent:     msg.Content,\n\t\t})\n\tcase \"EchoResponse\":\n\t\tvar resp shared.EchoResponse\n\t\tjson.Unmarshal(event.Payload, &resp)\n\n\t\ten.Net.Send(ctx, \"TESTER\", shared.ReplyReceived{\n\t\t\tBaseMessage: newBaseMessage(en.Net.ID, \"TESTER\", \"ReplyReceived\"),\n\t\t\tEchoID:      resp.EchoID,\n\t\t\tSuccess:     true,\n\t\t})\n\t}\n}\n\nfunc main() {\n\tid := os.Getenv(\"ID\")\n\tif id == \"\" {\n\t\tlog.Fatal(\"ID environment variable not set\")\n\t\treturn\n\t}\n\tPeers = strings.Split(os.Getenv(\"PEERS\"), \",\")\n\tif Peers == nil {\n\t\tlog.Fatal(\"PEERS environment variable not set\")\n\t\treturn\n\t}\n\n\tctx := context.Background()\n\techoNode := NewEchoNode(id)\n    defer echoNode.Net.Close()\n\tgo echoNode.Run(ctx)\n\tselect {}\n}",
        "shared/protocol.go": "package shared\n\nimport \"github.com/distcodep7/dsnet/dsnet\"\n\n// ==========================================================\n// 1. EXTERNAL TRIGGERS (The \"Input\")\n// ==========================================================\n\n// SendTrigger sends a trigger message to a single node to start the echo process.\ntype SendTrigger struct {\n\tdsnet.BaseMessage      // Type: \"SendTrigger\"\n\tEchoID                 string `json:\"echo_id\"`\n\tContent                string `json:\"content\"`\n}\n\n// ==========================================================\n// 2. INTERNAL PROTOCOL (The \"Logic\")\n// ==========================================================\n\ntype EchoMessage struct {\n\tdsnet.BaseMessage     // Type: \"EchoMessage\"\n\tEchoID                string `json:\"echo_id\"`\n\tContent               string `json:\"content\"`\n}\n\n// EchoResponse is sent from each receiving node back to the original sender.\ntype EchoResponse struct {\n\tdsnet.BaseMessage     // Type: \"EchoResponse\"\n\tEchoID                string `json:\"echo_id\"`\n\tContent               string `json:\"content\"`\n}\n\n// ==========================================================\n// 3. EXTERNAL RESULTS (The \"Output\")\n// ==========================================================\n\n// ReplyReceived is emitted *once*, by the original sender,\n// after it has received an EchoResponse from every other node.\ntype ReplyReceived struct {\n\tdsnet.BaseMessage\n\tEchoID                 string `json:\"echo_id\"`\n\tSuccess                bool `json:\"success\"`\n}"
      },
      "buildCommand": "go build -o ./stud ./student/main.go",
      "entryCommand": "./wrapper -cmd ./stud",
      "globalEnvs": [],
      "replicaConfigs": [
        {
          "alias": "Node-A",
          "envs": []
        },
        {
          "alias": "Node-B",
          "envs": [],
          "id": 1
        }
      ]
    },
    "testContainer": {
      "alias": "test-container",
      "testFiles": {
        "test/main_test.go": "package test\n\nimport (\n\t\"context\"\n\t\"encoding/json\"\n\t\"log\"\n\t\"os\"\n\t\"strings\"\n\t\"testing\"\n\t\"time\"\n\n\t\"runner/shared\"\n\n\t\"github.com/distcodep7/dsnet/dsnet\"\n\t\"github.com/distcodep7/dsnet/testing/controller\"\n\t\"github.com/distcodep7/dsnet/testing/disttest\"\n\t\"github.com/distcodep7/dsnet/testing/wrapper\"\n)\n\nvar (\n    Peers []string\n    ID    string\n    WM    *wrapper.WrapperManager\n    ctx   context.Context\n)\n\nfunc TestEchoTwoNodes(t *testing.T) {\n\tdisttest.Wrap(t, func(t *testing.T) {\n\t\tgo controller.Serve(controller.TestConfig{})\n\t\ttime.Sleep(50 * time.Millisecond)\n\n\t\tWM.StartAll(ctx)\n\t\ttime.Sleep(1 * time.Second)\n\n\t\ttester, err := dsnet.NewNode(\"TESTER\", \"localhost:50051\")\n\t\tif err != nil {\n\t\t\tt.Fatalf(\"Failed to create TESTER node: %v\", err)\n\t\t}\n\t\tdefer tester.Close()\n\n\t\ttrigger := shared.SendTrigger{\n\t\t\tBaseMessage: dsnet.BaseMessage{\n\t\t\t\tFrom: \"TESTER\",\n\t\t\t\tTo:   Peers[0],\n\t\t\t\tType: \"SendTrigger\",\n\t\t\t},\n\t\t\tEchoID:  \"TEST_001\",\n\t\t\tContent: \"Hello, DSNet!\",\n\t\t}\n\t\ttester.Send(ctx, Peers[0], trigger)\n\n\t\ttimeout := time.After(30 * time.Second)\n        for {\n            select {\n            case event := <-tester.Inbound:\n                if (event.Type == \"ReplyReceived\") {\n                    var result shared.ReplyReceived\n                    json.Unmarshal(event.Payload, &result)\n\n                    if result.EchoID == \"TEST_001\" {\n                        log.Printf(\"Received EchoResponse from %s\\n\", Peers[1])\n                        return\n                    }\n                }\n            case <-timeout:\n                t.Fatal(\"Timed out waiting for ReplyReceived\")\n            }\n        }\n\t})\n}\n\nfunc TestMain(m *testing.M) {\n    Peers = strings.Split(os.Getenv(\"PEERS\"), \",\")\n    ID = os.Getenv(\"ID\")\n    ctx = context.Background()\n    WM = wrapper.NewWrapperManager(8090, Peers...)\n\n    const attempts = 200\n    const sleepInterval = 50 * time.Millisecond\n    for i := 1; i <= attempts; i++ {\n        errors := WM.ReadyAll(ctx)\n        allReady := true\n        for peer, err := range errors {\n            if err != nil {\n                allReady = false\n                log.Printf(\"Peer %s not ready: %v\\n\", peer, err)\n            }\n        }\n        if allReady {\n            log.Println(\"All peers are ready\")\n            break\n        }\n        time.Sleep(sleepInterval)\n    }\n\n    code := m.Run()\n    _ = disttest.Write(\"test_results.json\")\n    WM.ShutdownAll(ctx)\n    os.Exit(code)\n}",
        "shared/protocol.go": "package shared\n\nimport \"github.com/distcodep7/dsnet/dsnet\"\n\n// ==========================================================\n// 1. EXTERNAL TRIGGERS (The \"Input\")\n// ==========================================================\n\n// SendTrigger sends a trigger message to a single node to start the echo process.\ntype SendTrigger struct {\n\tdsnet.BaseMessage\n\tEchoID  string `json:\"echo_id\"`\n\tContent string `json:\"content\"`\n}\n\n// ==========================================================\n// 2. INTERNAL PROTOCOL (The \"Logic\")\n// ==========================================================\n\ntype EchoMessage struct {\n\tdsnet.BaseMessage\n\tEchoID  string `json:\"echo_id\"`\n\tContent string `json:\"content\"`\n}\n\ntype EchoResponse struct {\n\tdsnet.BaseMessage\n\tEchoID  string `json:\"echo_id\"`\n\tContent string `json:\"content\"`\n}\n\n// ==========================================================\n// 3. EXTERNAL RESULTS (The \"Output\")\n// ==========================================================\n\ntype ReplyReceived struct {\n\tdsnet.BaseMessage\n\tEchoID  string `json:\"echo_id\"`\n\tSuccess bool   `json:\"success\"`\n}"
      },
      "envs": [],
      "buildCommand": "go test -c -o ./test_binary ./test/",
      "entryCommand": "./test_binary"
    }
  },
  "userId": "$2b$10$c0aFkt1Lw1YRi94znmYIzeBOaWSnQc60d8sY2yT4E4NTeE5RD2bQK",
  "timeout": 60
}